{"ast":null,"code":"const URL = \"http://localhost:8080/eksamen/api/\";\n\nfunction handleHttpErrors(res) {\n  if (!res.ok) {\n    return Promise.reject({\n      status: res.status,\n      fullError: res.json()\n    });\n  }\n\n  return res.json();\n}\n\nclass ApiFacade {\n  constructor() {\n    this.roles = [0];\n\n    this.getRole = () => {\n      let jwtToken = localStorage.getItem(\"jwtToken\");\n\n      if (jwtToken !== null) {\n        let tokenData = jwtToken.split(\".\")[1];\n        let decodedData = window.atob(tokenData);\n        let dataJson = JSON.parse(decodedData);\n        return dataJson.roles;\n      }\n\n      return \"notloggedin\";\n    };\n\n    this.setToken = token => {\n      localStorage.setItem(\"jwtToken\", token);\n    };\n\n    this.getToken = () => {\n      return localStorage.getItem(\"jwtToken\");\n    };\n\n    this.loggedIn = () => {\n      const loggedIn = this.getToken() != null;\n      return loggedIn;\n    };\n\n    this.logout = () => {\n      localStorage.removeItem(\"jwtToken\");\n      this.roles = [0];\n    };\n\n    this.fetchData = () => {\n      const urlFetch = this.roles.includes(\"user\") ? \"/api/info/user\" : \"/api/info/admin\";\n      const options = this.makeOptions(\"GET\", true); //True add's the token\n\n      return fetch(URL + urlFetch, options).then(handleHttpErrors);\n    };\n\n    this.login = async (user, pass) => {\n      const options = this.makeOptions(\"POST\", true, {\n        username: user,\n        password: pass\n      });\n      const res = await fetch(URL + \"login\", options);\n      const res_1 = await handleHttpErrors(res);\n      this.setToken(res_1.token);\n      this.roles = res_1.roles;\n    };\n\n    this.addMovie = async movie => {\n      const options = this.makeOptions(\"POST\", true, movie);\n      const res = await fetch(URL + \"movie/addmovie\", options);\n      const res_1 = await handleHttpErrors(res);\n      this.setToken(res_1.token);\n      this.roles = res_1.roles;\n    };\n\n    this.fetchAllDirectors = async () => {\n      const options = this.makeOptions(\"GET\", false); //True add's the token\n\n      const res = await fetch(URL + `movie/alldirectors`, options);\n      return handleHttpErrors(res);\n    };\n\n    this.fetchAllActors = async () => {\n      const options = this.makeOptions(\"GET\", false); //True add's the token\n\n      const res = await fetch(URL + `movie/allactors`, options);\n      return handleHttpErrors(res);\n    };\n\n    this.fetchAllGenres = async () => {\n      const options = this.makeOptions(\"GET\", false); //True add's the token\n\n      const res = await fetch(URL + `movie/allgenres`, options);\n      return handleHttpErrors(res);\n    };\n\n    this.fetchMovies = async search => {\n      const options = this.makeOptions(\"GET\", false); //True add's the token\n\n      const res = await fetch(URL + `movie/${search.searchBy}/${search.query}`, options);\n      return handleHttpErrors(res);\n    };\n\n    this.getCategoryCount = async search => {\n      const options = this.makeOptions(\"GET\", true); //True add's the token\n\n      const res = await fetch(URL + `categoryCount/${search}`, options);\n      return handleHttpErrors(res);\n    };\n  }\n\n  makeOptions(method, addToken, body) {\n    var opts = {\n      method: method,\n      headers: {\n        \"Content-type\": \"application/json\",\n        Accept: \"application/json\"\n      }\n    };\n\n    if (addToken && this.loggedIn()) {\n      opts.headers[\"x-access-token\"] = this.getToken();\n    }\n\n    if (body) {\n      opts.body = JSON.stringify(body);\n    }\n\n    return opts;\n  }\n\n}\n\nconst facade = new ApiFacade();\nexport default facade;","map":{"version":3,"sources":["C:/Users/goo-x/OneDrive/Dokumenter/NetBeansProjects/3sem/Programmeringseksamen/Eksamen/frontend/src/apiFacade.js"],"names":["URL","handleHttpErrors","res","ok","Promise","reject","status","fullError","json","ApiFacade","roles","getRole","jwtToken","localStorage","getItem","tokenData","split","decodedData","window","atob","dataJson","JSON","parse","setToken","token","setItem","getToken","loggedIn","logout","removeItem","fetchData","urlFetch","includes","options","makeOptions","fetch","then","login","user","pass","username","password","res_1","addMovie","movie","fetchAllDirectors","fetchAllActors","fetchAllGenres","fetchMovies","search","searchBy","query","getCategoryCount","method","addToken","body","opts","headers","Accept","stringify","facade"],"mappings":"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","sourcesContent":["const URL = \"http://localhost:8080/eksamen/api/\";\nfunction handleHttpErrors(res) {\n  if (!res.ok) {\n    return Promise.reject({ status: res.status, fullError: res.json() });\n  }\n  return res.json();\n}\n\nclass ApiFacade {\n\n  roles = [0];\n\n  getRole = () => {\n    let jwtToken = localStorage.getItem(\"jwtToken\");\n    if (jwtToken !== null) {\n      let tokenData = jwtToken.split(\".\")[1];\n      let decodedData = window.atob(tokenData);\n      let dataJson = JSON.parse(decodedData);\n      return dataJson.roles;\n    }\n    return \"notloggedin\";\n  };\n\n  setToken = token => {\n    localStorage.setItem(\"jwtToken\", token);\n  };\n  getToken = () => {\n    return localStorage.getItem(\"jwtToken\");\n  };\n  loggedIn = () => {\n    const loggedIn = this.getToken() != null;\n    return loggedIn;\n  };\n  logout = () => {\n    localStorage.removeItem(\"jwtToken\");\n    this.roles = [0];\n  };\n\n  makeOptions(method, addToken, body) {\n    var opts = {\n      method: method,\n      headers: {\n        \"Content-type\": \"application/json\",\n        Accept: \"application/json\"\n      }\n    };\n    if (addToken && this.loggedIn()) {\n      opts.headers[\"x-access-token\"] = this.getToken();\n    }\n    if (body) {\n      opts.body = JSON.stringify(body);\n    }\n    return opts;\n  }\n\n  fetchData = () => {\n    const urlFetch = (this.roles.includes(\"user\") ? \"/api/info/user\" : \"/api/info/admin\");\n    const options = this.makeOptions(\"GET\", true); //True add's the token\n    return fetch(URL + urlFetch, options).then(handleHttpErrors);\n  };\n\n  login = async (user, pass) => {\n    const options = this.makeOptions(\"POST\", true, {\n      username: user,\n      password: pass\n    });\n\n    const res = await fetch(URL + \"login\", options);\n    const res_1 = await handleHttpErrors(res);\n    this.setToken(res_1.token);\n    this.roles = res_1.roles;\n  };\n\n  addMovie = async (movie) => {\n    const options = this.makeOptions(\"POST\", true, movie);\n\n    const res = await fetch(URL + \"movie/addmovie\", options);\n    const res_1 = await handleHttpErrors(res);\n    this.setToken(res_1.token);\n    this.roles = res_1.roles;\n  };\n\n  fetchAllDirectors = async () => {\n    const options = this.makeOptions(\"GET\", false); //True add's the token\n    const res = await fetch(URL + `movie/alldirectors`, options);\n    return handleHttpErrors(res);\n  }\n\n  fetchAllActors = async () => {\n    const options = this.makeOptions(\"GET\", false); //True add's the token\n    const res = await fetch(URL + `movie/allactors`, options);\n    return handleHttpErrors(res);\n  }\n\n  fetchAllGenres = async () => {\n    const options = this.makeOptions(\"GET\", false); //True add's the token\n    const res = await fetch(URL + `movie/allgenres`, options);\n    return handleHttpErrors(res);\n  }\n\n  fetchMovies = async (search) => {\n    const options = this.makeOptions(\"GET\", false); //True add's the token\n    const res = await fetch(URL + `movie/${search.searchBy}/${search.query}`, options);\n    return handleHttpErrors(res);\n  }\n\n  getCategoryCount = async (search) => {\n    const options = this.makeOptions(\"GET\", true); //True add's the token\n    const res = await fetch(URL + `categoryCount/${search}`, options);\n    return handleHttpErrors(res);\n  }\n}\nconst facade = new ApiFacade();\nexport default facade;\n"]},"metadata":{},"sourceType":"module"}